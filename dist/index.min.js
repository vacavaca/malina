(function(e,t){typeof exports==="object"&&typeof module!=="undefined"?t(exports,require("path-to-regexp")):typeof define==="function"&&define.amd?define(["exports","path-to-regexp"],t):t(e.malina={},e.pathToRegexp)})(this,function(e,u){"use strict";u=u&&u.hasOwnProperty("default")?u["default"]:u;function y(e){if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){y=function(e){return typeof e}}else{y=function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e}}return y(e)}function s(e,t,n,r,i,a,o){try{var u=e[a](o);var s=u.value}catch(e){n(e);return}if(u.done){t(s)}else{Promise.resolve(s).then(r,i)}}function f(u){return function(){var e=this,o=arguments;return new Promise(function(t,n){var r=u.apply(e,o);function i(e){s(r,t,n,i,a,"next",e)}function a(e){s(r,t,n,i,a,"throw",e)}i(undefined)})}}function l(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}function n(e,t,n){if(t)r(e.prototype,t);if(n)r(e,n);return e}function i(e,t,n){if(t in e){Object.defineProperty(e,t,{value:n,enumerable:true,configurable:true,writable:true})}else{e[t]=n}return e}function d(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};var r=Object.keys(n);if(typeof Object.getOwnPropertySymbols==="function"){r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))}r.forEach(function(e){i(t,e,n[e])})}return t}function o(e,t){if(e==null)return{};var n={};var r=Object.keys(e);var i,a;for(a=0;a<r.length;a++){i=r[a];if(t.indexOf(i)>=0)continue;n[i]=e[i]}return n}function c(e,t){if(e==null)return{};var n=o(e,t);var r,i;if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++){r=a[i];if(t.indexOf(r)>=0)continue;if(!Object.prototype.propertyIsEnumerable.call(e,r))continue;n[r]=e[r]}}return n}function k(e,t){return a(e)||v(e,t)||p()}function A(e){return t(e)||h(e)||m()}function t(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}function a(e){if(Array.isArray(e))return e}function h(e){if(Symbol.iterator in Object(e)||Object.prototype.toString.call(e)==="[object Arguments]")return Array.from(e)}function v(e,t){var n=[];var r=true;var i=false;var a=undefined;try{for(var o=e[Symbol.iterator](),u;!(r=(u=o.next()).done);r=true){n.push(u.value);if(t&&n.length===t)break}}catch(e){i=true;a=e}finally{try{if(!r&&o["return"]!=null)o["return"]()}finally{if(i)throw a}}return n}function m(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function p(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}var w=function e(t,n,r,i){l(this,e);this.template=t;this.state=n;this.actions=r;this.hooks=i};var g=function e(t){var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var r=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var i=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;return new w(t instanceof Function?t:function(){return t},n,r,i)};var b=function(){function r(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:[];l(this,r);if(e==null)throw new Error("JSX tag empty ");this.tag=e;this.attrs=t;this.children=n}n(r,[{key:"toString",value:function e(){var t=typeof this.tag==="string"?this.tag:"View";return"".concat(t," ").concat(JSON.stringify(this.attrs||{})).concat(this.children.length>0?"\n".concat(this.children.map(function(e){if(e==null)return"\t''";var t=e.toString();return t.split("\n").map(function(e){return"\t".concat(e)}).join("\n")}).join("\n")):"")}}]);return r}();var x=function e(t){return t instanceof b&&t.tag instanceof w};var E=function e(t){return t instanceof b&&!x(t)};var N=function e(t){return typeof t==="string"};var S=function e(t,n){for(var r=arguments.length,i=new Array(r>2?r-2:0),a=2;a<r;a++){i[a-2]=arguments[a]}var o=i.length===1&&Array.isArray(i[0])?i[0]:i;return new b(t,n,o)};var V=function e(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++){n[r]=arguments[r]}if(n.length===0)return function(e){return e};if(n.length===1)return n[0];return n.reduce(function(e,t){return function(){return e(t.apply(void 0,arguments))}})};var T=function e(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))};var P=function e(t,n){if(t===n)return true;if(t==null!==(n==null))return false;if(t==null)return true;var r=T(t);var i=r.length;if(T(n).length!==i)return false;var a=true;var o=false;var u=undefined;try{for(var s=r[Symbol.iterator](),l;!(a=(l=s.next()).done);a=true){var f=l.value;if(t[f]!==n[f])return false}}catch(e){o=true;u=e}finally{try{if(!a&&s.return!=null){s.return()}}finally{if(o){throw u}}}return true};var F=function e(t,n){var r={};var i={};var a=t.length;var o=0;while(o<a){i[t[o]]=true;o+=1}var u=true;var s=false;var l=undefined;try{for(var f=T(n)[Symbol.iterator](),c;!(u=(c=f.next()).done);u=true){var h=c.value;if(!(h in i))r[h]=n[h]}}catch(e){s=true;l=e}finally{try{if(!u&&f.return!=null){f.return()}}finally{if(s){throw l}}}return r};var L=function e(t){var n=[];var r=t.length;var i=0;while(i<r){if(Array.isArray(t[i])){var a=e(t[i]);var o=a.length;var u=0;while(u<o){n[n.length]=a[u];u+=1}}else n[n.length]=t[i];i+=1}return n};var j=function e(t){return"on".concat(t[0].toUpperCase()).concat(t.substr(1))};var C=function e(t){var n=t.toLowerCase();return n.startsWith("on")?n.substr(2):n};var O=function e(t){var n=t.isSvg,r=n===void 0?false:n;l(this,e);this.isSvg=r};var I=function e(t){return Array.isArray(t)&&t.length===2&&t[0]instanceof Function};var z=function e(t,n){return I(t)&&I(n)&&t[0]===n[0]&&t[1]===n[1]};var K=false;var R=[];var D=new O({});var H=new O({isSvg:true});var U=function e(t){return t.length===0};var W=function e(t,n){return t.tag===n.tag};var M=function e(n){return n.every(function(e,t){return t===0||!x(e)||!x(n[t-1])||e.attrs.key||!W(e,n[t-1])})};var q=function(){function s(e,t){l(this,s);var n=e.tag,r=e.attrs,i=e.children;var a=n.state instanceof Function?n.state(r):n.state;var o=n.actions instanceof Function?n.actions(r):n.actions;var u=n.hooks instanceof Function?n.hooks(r):n.hooks;this.template=n.template;this.state=d({},a||{},r||{});this.actions=this.bindActions(o||{});this.children=i;this.hooks=u||{};this.renderingContext=t||D;this.templateLock=false;this.updateLock=false;this.element=null;this.node=null;this.innerViews=new Map;this.parametrizedEventListeners=new Map;this.scheduledActions=[];this.mounted=false;this.destroyed=false;this.trackedActionUpdate=false;this.container=this.callHook("create")}n(s,[{key:"mount",value:function e(t,n){var r=this;var i=t.ownerDocument;if(this.destroyed)return;var a=false;if(!K){K=true;a=true}var o=this.renderTemplate();if(Array.isArray(o))throw new Error("View can only have one root element");if(E(o)){if(o.tag==="svg")this.renderingContext=H;var u=this.mountNodeElement(t,n,o,[]);this.element=u}else if(x(o)){var s=this.instantiateInnerView(o,[]);s.mount(t,n);this.element=s.element}else{var l=i.createTextNode("".concat(o!=null?o:""));this.element=l;var f=t.childNodes[n]||null;t.insertBefore(l,f)}this.node=o;this.mounted=true;var c=true;var h=false;var v=undefined;try{for(var d=this.scheduledActions[Symbol.iterator](),y;!(c=(y=d.next()).done);c=true){var m=k(y.value,2),p=m[0],w=m[1];this.callAction.apply(this,[p].concat(A(w)))}}catch(e){h=true;v=e}finally{try{if(!c&&d.return!=null){d.return()}}finally{if(h){throw v}}}this.scheduledActions=[];if(a){for(var g=0;g<R.length;g++){var b=R[g];b()}this.callHook("mount");K=false}else R.push(function(){return r.callHook("mount")})}},{key:"update",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;if(this.destroyed)throw new Error("View has been destroyed");var r=this.updateState(t);var i=this.updateChildrenState(n);var e=this.state!==r||this.children!==i;this.state=r;this.children=i;if(this.mounted&&e){this.refresh();this.callHook("update")}return e}},{key:"refresh",value:function e(){var t=this.renderTemplate();var n=this.node;this.node=t;this.patch(this.element,n,t,[])}},{key:"unmount",value:function e(t){this.mounted=false;if(E(this.node))this.destroyInnerViews(this.node,[]);else if(x(this.node))this.destroyInnerView([]);if(t)this.element.remove();this.callHook("unmount");this.element=null}},{key:"destroy",value:function e(t){this.unmount(t);this.callHook("destroy");this.destroyed=true}},{key:"renderTemplate",value:function e(){this.templateLock=true;var t=this.template(this.state,this.actions,this.children);if(Array.isArray(t))throw new Error("Only one root element must be rendered for a view");t=t!=null?t:"";this.templateLock=false;return t}},{key:"bindActions",value:function e(i){var a=this;var n={};var t=true;var r=false;var o=undefined;try{var u=function e(){var r=l.value;var t=i[r];if(t instanceof Function)n[r]=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++){t[n]=arguments[n]}return a.callAction.apply(a,[i[r]].concat(t))};else n[r]=a.bindActions(t)};for(var s=T(i)[Symbol.iterator](),l;!(t=(l=s.next()).done);t=true){u()}}catch(e){r=true;o=e}finally{try{if(!t&&s.return!=null){s.return()}}finally{if(r){throw o}}}return n}},{key:"callAction",value:function e(t){var r=this;if(this.templateLock)throw new Error("Actions can't be called while rendering view template");for(var n=arguments.length,i=new Array(n>1?n-1:0),a=1;a<n;a++){i[a-1]=arguments[a]}if(this.mounted){var o=!this.updateLock;this.updateLock=true;var u=t.apply(void 0,i)(this.state,this.actions);if(u instanceof Promise){this.updateLock=false;if(this.trackedActionUpdate)this.refresh();this.trackedActionUpdate=false;return f(regeneratorRuntime.mark(function e(){var n;return regeneratorRuntime.wrap(function e(t){while(1){switch(t.prev=t.next){case 0:t.next=2;return u;case 2:n=t.sent;if(!r.destroyed)r.update(n);return t.abrupt("return",r.state);case 5:case"end":return t.stop()}}},e,this)}))()}else{if(o){if(!this.destroyed&&this.mounted){var s=this.update(u);if(!s&&this.trackedActionUpdate)this.refresh();this.trackedActionUpdate=false}else if(!this.destroyed)this.state=this.updateState(u)}else{var l=this.updateState(u);this.trackedActionUpdate=this.trackedActionUpdate||this.state!==l;this.state=l}this.updateLock=false;return this.state}}else this.scheduledActions.push([t,i])}},{key:"updateState",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;if(t==null||t===this.state)return this.state;var n=t!==null?d({},this.state,t):this.state;return!P(this.state,n)?n:this.state}},{key:"updateChildrenState",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;if(t===null||t===null)return this.children;var n=this.children==null||this.children.length===0;var r=t.length===0;if(n!==r)return t;else return!P(this.children,t)?t:this.children}},{key:"callHook",value:function e(t){if(t in this.hooks)this.hooks[t](this.element,this.state,this.actions)}},{key:"patch",value:function e(t,n,r,i){if(n===r)return;if(E(n)){if(r==null)this.patchFromNodeToNone(t,n,i);else if(E(r))this.patchFromNodeToNode(t,n,r,i);else if(x(r))this.patchFromNodeToView(t,n,r,i);else this.patchFromNodeToText(t,n,r,i)}else if(x(n)){if(r==null)this.patchFromViewToNone(t,n,i);else if(E(r))this.patchFromViewToNode(t,n,r,i);else if(x(r))this.patchFromViewToView(t,n,r,i);else this.patchFromViewToText(t,n,r,i)}else{if(r==null)this.patchFromTextToNone(t,i);else if(E(r))this.patchFromTextToNode(t,r,i);else if(x(r))this.patchFromTextToView(t,r,i);else this.patchTextNodes(t,n,r,i)}}},{key:"patchFromTextToNone",value:function e(t,n){if(U(n))throw new Error("Root element deleted during patch");t.parentNode.removeChild(t)}},{key:"patchTextNodes",value:function e(t,n,r,i){if(n!==r){var a=t.ownerDocument.createTextNode("".concat(r));t.replaceWith(a);if(U(i))this.element=a}}},{key:"patchFromTextToNode",value:function e(t,n,r){var i=this.createNodeElement(t.ownerDocument,n,r);t.replaceWith(i);if(U(r))this.element=i}},{key:"patchFromTextToView",value:function e(t,n,r){var i=this.instantiateInnerView(n,r);var a=Array.from(t.parentNode.childNodes).findIndex(function(e){return e===t});var o=t.parentNode;t.remove();i.mount(o,a);if(U(r))this.element=i.element}},{key:"patchFromNodeToNone",value:function e(t,n,r){if(U(r))throw new Error("Root element deleted during patch");this.removeParametrizedListeners(n,r);this.destroyInnerViews(n,r);t.remove()}},{key:"patchFromNodeToText",value:function e(t,n,r,i){this.removeParametrizedListeners(n,i);this.destroyInnerViews(n,i);var a=t.ownerDocument.createTextNode("".concat(r));t.replaceWith(a);if(U(i))this.element=a}},{key:"patchFromNodeToNode",value:function e(t,n,r,i){if(n===r)return;if(n.tag===r.tag){this.updateAttributes(t,n,r,i);this.updateChildren(t,n,r,i)}else{this.removeParametrizedListeners(n,i);this.destroyInnerViews(n,i);var a=this.createNodeElement(t.ownerDocument,r,i);t.replaceWith(a);if(U(i))this.element=a}}},{key:"patchFromNodeToView",value:function e(t,n,r,i){this.removeParametrizedListeners(n,i);this.destroyInnerViews(n,i);var a=this.instantiateInnerView(r,i);var o=Array.from(t.parentNode.childNodes).findIndex(function(e){return e===t});var u=t.parentNode;t.remove();a.mount(u,o);if(U(i))this.element=a.element}},{key:"patchFromViewToNone",value:function e(t,n,r){if(U(r))throw new Error("Root element deleted during patch");this.destroyInnerView(r);t.remove()}},{key:"patchFromViewToText",value:function e(t,n,r,i){this.destroyInnerView(i);var a=t.ownerDocument.createTextNode("".concat(r));t.replaceWith(a);if(U(i))this.element=a}},{key:"patchFromViewToNode",value:function e(t,n,r,i){this.destroyInnerView(i);var a=this.createNodeElement(t.ownerDocument,r,i);t.replaceWith(a);if(U(i))this.element=a}},{key:"patchFromViewToView",value:function e(t,n,r,i){if(n===r)return;if(W(n,r)&&n.attrs.key===r.attrs.key){var a=this.getInstantiatedView(i);a.update(r.attrs,r.children)}else{this.destroyInnerView(i);var o=this.instantiateInnerView(r,i);var u=Array.from(t.parentNode.childNodes).findIndex(function(e){return e===t});var s=t.parentNode;t.remove();o.mount(s,u);if(U(i))this.element=o.element}}},{key:"unmountPatch",value:function e(){this.mounted=false;this.callHook("unmount");this.element=null}},{key:"destroyInnerViews",value:function e(t,n){for(var r in t.children){var i=n.concat([r]);var a=t.children[r];if(x(a))this.destroyInnerView(i);else if(E(a))this.destroyInnerViews(a,i)}}},{key:"destroyInnerView",value:function e(t){var n=this.getInstantiatedView(t);n.destroy(false);this.removeInstantiatedView(t)}},{key:"createNodeElement",value:function e(t,n,r){var i;if(this.renderingContext.isSvg)i=t.createElementNS("http://www.w3.org/2000/svg",n.tag);else i=t.createElement(n.tag);this.refreshAttributes(i,n,r);this.refreshChildren(i,n,r);return i}},{key:"mountNodeElement",value:function e(t,n,r,i){var a=t.ownerDocument;var o;if(this.renderingContext.isSvg)o=a.createElementNS("http://www.w3.org/2000/svg",r.tag);else o=a.createElement(r.tag);this.refreshAttributes(o,r,i);var u=t.childNodes[n]||null;t.insertBefore(o,u);this.refreshChildren(o,r,i,true);return o}},{key:"refreshAttributes",value:function e(t,n,r){for(var i in n.attrs){var a=n.attrs[i];this.addAttribute(t,i,a,r)}}},{key:"updateAttributes",value:function e(t,n,r,i){if(n===r)return;for(var a in r.attrs){var o=r.attrs[a];if(a in n.attrs){var u=n.attrs[a];this.updateAttribute(t,a,u,o,i)}else this.addAttribute(t,a,o,i)}for(var s in n.attrs){if(!(s in r.attrs))this.removeAttribute(t,s,n.attrs[s],i)}}},{key:"addAttribute",value:function e(t,n,r,i){if(n==="style"){for(var a in r){this.setStyleProp(t,a,r[a]||"")}}else if(r instanceof Function)this.addEventListener(t,C(n),r);else if(I(r)){var o=this.createParametrizedListener(r[0],r[1],i,n);var u=C(n);this.addEventListener(t,u,o)}else if(n==="data"&&r!=null&&y(r)==="object"){for(var s in r){t.dataset[s]=r[s]}}else if(n!=="focus"&&n in t&&!this.renderingContext.isSvg&&r!=null)t[n]=r;else if(typeof r==="boolean"){if(n==="focus"&&t.focus&&t.blur){if(r)t.focus();else t.blur()}else t.setattribute(n,n)}else if(r!=null)t.setAttribute(n,r)}},{key:"updateAttribute",value:function e(t,n,r,i,a){if(r===i)return;if(z(r,i))return;if(n==="style"){for(var o in r){if(!(o in i))this.removeStyleProp(t,o)}for(var u in i){var s=i[u]||"";this.setStyleProp(t,u,s)}}else if(i instanceof Function){this.removeAttribute(t,n,r,a);this.addAttribute(t,n,i,a)}else if(I(i)){this.removeAttribute(t,n,r,a);this.addAttribute(t,n,i,a)}else if(n==="data"){var l=r!=null&&y(r)==="object";var f=i!=null&&y(i)==="object";if(l&&f){for(var c in r){if(!(c in i))delete t.dataset[c]}for(var h in i){t.dataset[h]=i[h]}}else if(l&&!f){for(var v in t.dataset){delete t.dataset[v]}}else if(!l&&f){for(var d in i){t.dataset[d]=i[d]}}}else if(n!=="focus"&&n in t&&!this.renderingContext.isSvg)t[n]=i;else if(typeof r==="boolean"){if(n==="focus"){if(t.focus&&t.blur){if(i)t.focus();else t.blur()}}else{if(i)t.setAttribute(n,n);else t.removeAttribute(n)}}else{if(i!=null)t.setAttribute(n,i);else t.removeAttribute(i)}}},{key:"removeAttribute",value:function e(t,n,r,i){if(n==="style")t.style.cssText="";else if(r instanceof Function){var a=C(n);this.removeEventListener(t,a,r)}else if(I(r)){var o=this.getParametrizedListener(i,n);var u=C(n);this.removeEventListener(t,u,o)}else if(n==="data"&&r!=null&&y(r)==="object"){for(var s in t.dataset){delete t.dataset[s]}}else if(n!=="focus"&&n in t&&!this.renderingContext.isSvg)t[n]=undefined;else if(typeof r==="boolean"){if(n==="focus"&&t.blur)t.blur();else t.removeAttribute(n)}else if(r!=null)t.removeAttribute(n)}},{key:"setStyleProp",value:function e(t,n,r){if(n[0]==="-"){var i=r.indexOf("!important");var a=r;if(i!==-1)a=i!==r.slice(0,i)+r.slice(i+10);a=a.trim().replace(/;$/,"");t.style.setProperty(n,a)}else t.style[n]=r}},{key:"removeStyleProp",value:function e(t,n){if(n[0]==="-")t.style.removeProperty(n);else delete t.style[n]}},{key:"addEventListener",value:function e(i,a,t){if(i.addEventListener)i.addEventListener(a,t);else if(i.attachEvent)i.attachEvent(j(a),t);else{var n=i[a]&&i[a].listeners||[];if(i[a]!=null)i[a].listeners=n.concat(t);else{var r=function e(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++){n[r]=arguments[r]}return i[a].listeners.map(function(e){return e.apply(void 0,n)})};r.listeners=n.concat(t);i[a]=r}}}},{key:"removeEventListener",value:function e(t,n,r){if(t.removeEventListener)t.removeEventListener(n,r);else if(t.detachEvent)t.detachEvent(j(n),r);else{if(t[n]!=null&&t[n].listeners!=null)t[n].listeners=t[n].listener.filter(function(e){return e!==r})}}},{key:"refreshChildren",value:function e(t,n,r){var i=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;if(!M(n.children))throw new Error("Every view node in an array must have an unique 'key' attribute");for(var a in n.children){var o=n.children[a];var u=r.concat([a]);this.addChildren(t,o,a,u,i)}}},{key:"addChildren",value:function e(t,n){var r=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var i=arguments.length>3?arguments[3]:undefined;var a=arguments.length>4&&arguments[4]!==undefined?arguments[4]:false;if(E(n)){if(a)this.mountNodeElement(t,null,n,i);else{var o=this.createNodeElement(t.ownerDocument,n,i);t.appendChild(o)}}else if(x(n)){var u=this.instantiateInnerView(n,i);u.mount(t,r)}else if(n!=null){var s=t.ownerDocument.createTextNode("".concat(n));t.appendChild(s)}}},{key:"updateChildren",value:function e(t,n,r,i){if(n===r)return;if(!M(r.children))throw new Error("Every view node in an array must have an unique 'key' attribute");var a=Math.max(n.children.length,r.children.length);var o=0;for(var u=0;u<a;u++){var s=t.childNodes[u-o];var l=n.children[u];var f=u in r.children?r.children[u]:null;var c=i.concat([u]);if(l!=null){this.patch(s,l,f,c);if(f==null)o+=1}else{this.addChildren(t,f,u,c);o-=1}}}},{key:"instantiateInnerView",value:function e(t,n){var r=s.getPathKey(n);var i=s.instantiate(t,this.renderingContext);this.innerViews.set(r,{view:i,path:n.slice()});return i}},{key:"getInstantiatedView",value:function e(t){var n=s.getPathKey(t);var r=this.innerViews.get(n);return r!=null?r.view:null}},{key:"removeInstantiatedView",value:function e(t){var n=s.getPathKey(t);this.innerViews.delete(n)}},{key:"getParametrizedListener",value:function e(t,n){var r=s.getAttrKey(t,n);return this.parametrizedEventListeners.get(r)}},{key:"hasParametrizedListener",value:function e(t,n){var r=s.getAttrKey(t,n);return this.parametrizedEventListeners.has(r)}},{key:"createParametrizedListener",value:function e(i,a,t,n){var r=function e(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++){n[r]=arguments[r]}return i.apply(void 0,A(a).concat(n))};var o=s.getAttrKey(t,n);this.parametrizedEventListeners.set(o,r);return r}},{key:"removeParametrizedListeners",value:function e(t,n){for(var r in t.attrs){if(this.hasParametrizedListener(n,r))this.removeParametrizedListener(n,r)}for(var i in t.children){var a=n.concat([i]);var o=t.children[i];if(E(o))this.removeParametrizedListeners(o,a)}}},{key:"removeParametrizedListener",value:function e(t,n){var r=s.getAttrKey(t,n);this.parametrizedEventListeners.delete(r)}}],[{key:"instantiate",value:function e(t){var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;if(!x(t))throw new Error("View can only be instantiated from view-nodes");return new s(t,n)}},{key:"getPathKey",value:function e(t){return t.join(".")}},{key:"getAttrKey",value:function e(t,n){return"".concat(n,".").concat(s.getPathKey(t))}}]);return s}();var _=function e(t,n){var r=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var i=n;if(E(n))i=S(g(n));var a=t.ownerDocument.defaultView;var o=t instanceof a.SVGElement?H:D;var u=q.instantiate(i,o);u.mount(t,r);return u};var B=function e(n){return function(r){var e;if(r instanceof w)e=r;else if(typeof r==="string")e=g(function(e,t,n){return S(r,e,n)});else e=g(r);var t=n(e);if(t instanceof w)return t;else return g(t)}};var J=function e(r){return B(function(n){var i=function e(t){if(n.state instanceof Function)return n.state(t);else return n.state};var a=function e(t){if(r instanceof Function)return r(t);else return r};var e=function e(t){var n=i(t);var r=a(t);return d({},n!=null?n:{},r!=null?r:{})};return g(n.template,e,n.actions,n.hooks)})};var Y=function e(i){return B(function(n){var r=function e(t){if(n.actions instanceof Function)return n.actions(t);else return n.actions};var e=function e(t){return d({},r(t)||{},i||{})};return g(n.template,n.state,e,n.hooks)})};var G=function e(u){return B(function(n){var o=function e(t){if(n.hooks instanceof Function)return n.hooks(t);else return n.hooks};var e=function e(t){var a=o(t)||{};var n=d({},a);var r=function e(i){n[i]=function(t,n,r){var e=function e(){if(a[i]!=null)a[i](t,n,r)};u[i](e)(t,n,r)}};for(var i in u){r(i)}return n};return g(n.template,n.state,n.actions,e)})};var X=function e(t){return B(function(e){return g(t(e.template),e.state,e.actions,e.hooks)})};var $=function e(i){return B(function(r){return function(e,t,n){return S(r,i(e),n)}})};var Q=function(){function e(){l(this,e);this.listenerCounter=0;this.listeners={}}n(e,[{key:"subscribe",value:function e(t){var n=this;var r=++this.listenerCounter;this.listeners[r]=t;return function(){return delete n.listeners[r]}}},{key:"notify",value:function e(){for(var t in this.listeners){var n;(n=this.listeners)[t].apply(n,arguments)}}}]);return e}();var Z=Symbol("context");var ee=function(){function t(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};l(this,t);this.value=e;this.emitter=new Q}n(t,[{key:"subscribe",value:function e(t){return this.emitter.subscribe(t)}},{key:"update",value:function e(t){var n=d({},this.value,t);if(P(this.value,n))return;this.value=n;this.emitter.notify(this.value)}},{key:"get",value:function e(){return this.value}}]);return t}();var te=new Map;var ne=1e4;var re=function e(n){return B(function(e){if(te.has(e.template))return te.get(e.template);else{var t=n(e);if(te.size<ne)te.set(e.template,t);return t}})};var ie=re(X(function(a){return function(e,t,n){var r=e[Z];var i=a(e,t,n);if(r!=null)return ae(r)(i);else return i}}));var ae=function n(r){return function(e){if(x(e)){var t=d({},e.attrs!=null?e.attrs:{},i({},Z,r));return S(ie(e.tag),t,e.children.map(n(r)))}else if(E(e))return S(e.tag,e.attrs,e.children.map(n(r)));else return e}};var oe=function e(t){return t};var ue=function e(){var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:oe;var a=function e(t,n){var r=i(t);if(y(r)!=="object")throw new Error("Context must be an object derived from view's state and actions");return r};return V(G({create:function e(i){return function(e,t,n){i();if(!(Z in t)){var r=new ee(a(t,n));t[Z]=r}}},update:function e(i){return function(e,t,n){i();var r=t[Z];r.update(a(t,n))}}}),ie)};var se=Symbol("update");var le=Symbol("subscription");var fe=function e(t){return{context:t}};var ce=function e(){var a=arguments.length>0&&arguments[0]!==undefined?arguments[0]:fe;return V(G({create:function e(i){return function(e,t,n){var r=t[Z];if(r!=null){t[le]=r.subscribe(n[se]);Object.assign(t,a(r.value))}i();if(r==null)r=t[Z];if(r!=null){t[le]=r.subscribe(n[se]);Object.assign(t,a(r.value))}}},destroy:function e(r){return function(e,t,n){if(le in t)t[le]();r()}}}),Y(i({},se,function(e){return function(){return d({},a(e))}})))};var he=function e(r){return{push:function e(t,n){r.push(t,n)},replace:function e(t,n){r.replace(t,n)},forward:function e(){r.forward()},back:function e(){r.back()}}};var ve=function e(t){return{history:t,control:he(t)}};var de=Symbol("update");var ye=Symbol("subscription");var me=V(G({create:function e(i){return function(e,t,n){i();var r=t.router;t[ye]=r.history.listen(n[de])}},destroy:function e(r){return function(e,t,n){if(ye in t)t[ye]();r()}}}),Y(i({},de,function(e){return function(){return{location:e}}})));var pe=$(function(e){return d({router:e.router.control,location:e.location||e.router.history.location},F(["history","router"],e))});var we=Symbol("router");var ge=V(ce(function(e){return we in e?{router:e[we]}:{}}),ue(function(e){if(e==null||!("history"in e)&&!("router"in e))throw new Error("History object must be provided to the top-level routing view");if("history"in e&&!("router"in e)){var t=ve(e.history);return i({},we,t)}else return{}}));var be=V(ge,pe);var ke=V(me,ge,pe);var Ae=new Map;var xe=1e4;var Ee=function e(t,n){var r=Object.keys(n);if(!r.every(function(e){var t=n[e];return y(t)!=="object"&&typeof t!=="function"}))return null;r.sort();return"".concat(t).concat(r.map(function(e){return"".concat(e,":").concat(n[e])}).join(","))};var Ne=function e(t,n){var r=Ee(t,n);if(Ae.has(r))return Ae.get(r);else{var i=[];var a=u(t,i,n);var o={regexp:a,keys:i};if(Ae.size<xe)Ae.set(r,o);return o}};var Se=function e(t,n){var r=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};var i=Ne(n,r),a=i.regexp,o=i.keys;var u=a.exec(t);if(!u)return null;var s=u.slice(1);var l=o.reduce(function(e,t,n){return((e[t.name]=s[n]||null)||true)&&e},{});return l};var Ve=function e(t,n){var r=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};var i=r.hash?t.hash:t.pathname;if(r.hash&&!i.startsWith("#"))i="#".concat(i);if(!r.hash&&!i.startsWith("/"))i="/".concat(i);return Se(i,n,r)};var Te=Symbol("route");var Pe=ke(g(function(e,t){var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:[];var r=n[0];if(n.length>1)throw new Error("You must provide ony one child to Route it can be a render function or a jsx node");var i=Ve(e.location,e.path,d({},e.options,{hash:!!e.hash}));return r instanceof Function?r(i):r},i({},Te,true)));var Fe=V(J(i({},Te,true)),ke)(Pe);var Le=function c(h){var v=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;return function(e){var t=x(e);var n=t&&e.tag.state!=null;var r=null;if(n){var i=e.tag.state;r=i instanceof Function?i(e.attrs):i;n=r[Te]}if(n){var a=e.attrs;var o=e.children;var u=Ve(h,a.path,d({},a.options,{hash:!!a.hash}));if(u==null)return null;if(o.length>1){if(v)throw new Error("You must provide ony one child to Route it can be a render function or a jsx node");if(Array.isArray(o)){return L(o.map(c(h))).filter(function(e){return e!=null})}else return c(h)(o)}else if(o.length===1){var s=o[0];var l=s instanceof Function?s(u):s;if(Array.isArray(l)){return L(l.map(c(h))).filter(function(e){return e!=null})}else return c(h)(l)}else return null}else if(!N(e)){var f=L(e.children.map(c(h))).filter(function(e){return e!=null});return S(e.tag,e.attrs,f)}else return e}};var je=ke(g(function(e,t,n){if(n.length===0)return null;var r=n.map(Le(e.location,true)).filter(function(e){return e!=null});if(r.length===0)return null;if(r.length>1)throw new Error("Root element must be defined inside Switch node");return r[0]}));var Ce={to:null,target:null,replace:false,state:{}};var Oe={};Oe.handleClick=function(s){return function(e){var t=e.router,n=e.to,r=e.target,i=e.replace,a=e.state;if(n==null)return;var o=!!(s.metaKey||s.altKey||s.ctrlKey||s.shiftKey);if(!s.defaultPrevented&&s.button===0&&(!r||r==="_self")&&!o){s.preventDefault();var u=i?t.replace:t.push;u(n,a)}}};var Ie=be(g(function(e,t,n){var r=e.to,i=c(e,["to"]);return S("a",d({href:r,onClick:t.handleClick},F(["router","replace","state"],i)),n)},Ce,Oe));var ze=Symbol("store");var Ke=function e(t){return{store:t}};var Re=function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:Ke;return V(ce(function(e){return ze in e?t(e[ze].ref):{}}),ue(function(e){var t=e.store;return t!=null?i({},ze,{ref:t}):{}}))};var De={};De.update=function(o){return function(){var t=f(regeneratorRuntime.mark(function e(n){var r,i,a;return regeneratorRuntime.wrap(function e(t){while(1){switch(t.prev=t.next){case 0:r=n.state;i=d({},r);a=o;if(o instanceof Function)a=o(i);if(!(a instanceof Promise)){t.next=8;break}t.next=7;return a;case 7:a=t.sent;case 8:if(a!=null)i=d({},i,a);return t.abrupt("return",{state:i});case 10:case"end":return t.stop()}}},e,this)}));return function(e){return t.apply(this,arguments)}}()};var He=function e(t){return B(function(e){var o=V(ce(function(e){return ze in e?{store:e[ze].ref}:{}}),ue(function(e){var t=e.ref;return i({},ze,t)}),$(function(e){var t=e.ref,n=c(e,["ref"]);return d({},n)}))(e);return g(function(e,t,n){var r=e.state,i=e.ref,a=c(e,["state","ref"]);i.state=r;i.update=t.update;return S(o,d({},a,{ref:{ref:i}}),n)},{state:d({},t),ref:{}},De)})};var Ue=function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};return He(t)};var We=function a(o){return function(r){var i={};var e=function e(t){var n=o[t];if(n instanceof Function)i[t]=function(){return n(r).apply(void 0,arguments)};else if(y(n)==="object")i[t]=a(n)(r)};for(var t in o){e(t)}return i}};var Me="-";var qe=function e(t,n){if(n!=null)return"".concat(t).concat(Me).concat(n);else return t};var _e=function e(t){if(Array.isArray(t))return t.reduce(function(e,t){return i({},t,true)},{});else if(typeof t==="string")return e(t.split(" "));else return t};var Be=function e(t,n){return[t].concat(A(Object.keys(n).filter(function(e){return!!n[e]}).map(function(e){return"".concat(t).concat(Me.repeat(2)).concat(e)}))).filter(function(e){return!!e}).join(" ")};var Je=function e(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++){r[i-1]=arguments[i]}if(r.length===1){var a=r[0];if(typeof a==="string")return qe(t,a);else return Be(t,_e(a))}else if(r.length===2){var o=r[0],u=r[1];return Be(qe(t,o),_e(u))}else throw new Error("Unrecognized arguments")};var Ye=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++){t[n]=arguments[n]}if(t.length===1){var r=t[0];return function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++){t[n]=arguments[n]}return Je.apply(void 0,[r].concat(t))}}else return Je.apply(void 0,t)};e.classNames=Ye;e.cn=Ye;e.shallowEqual=P;e.compose=V;e.view=g;e.h=S;e.isElementNode=E;e.isViewNode=x;e.isTextNode=N;e.Node=b;e.mount=_;e.decorator=B;e.withState=J;e.withActions=Y;e.withHooks=G;e.withTemplate=X;e.mapState=$;e.withContext=ue;e.getContext=ce;e.Switch=je;e.Route=Fe;e.match=Ve;e.Link=Ie;e.withRouter=be;e.connectRouter=ke;e.connectStore=Re;e.withStore=Ue;e.bindActions=We;Object.defineProperty(e,"__esModule",{value:true})});

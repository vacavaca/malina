(function(e,t){typeof exports==="object"&&typeof module!=="undefined"?t(exports,require("malina-util")):typeof define==="function"&&define.amd?define(["exports","malina-util"],t):t(e.malinaDecorator={},e.malinaUtil)})(this,function(e,R){"use strict";R=R&&R.hasOwnProperty("default")?R["default"]:R;function t(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function r(e,t){return t={exports:{}},e(t,t.exports),t.exports}var K=r(function(e,t){Object.defineProperty(t,"__esModule",{value:true});var r=function e(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++){r[n]=arguments[n]}if(r.length===0)return function(e){return e};if(r.length===1)return r[0];return r.reduce(function(e,t){return function(){return e(t.apply(void 0,arguments))}})};var h=function e(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))};var n=function e(t,r){if(t===r)return true;if(t==null!==(r==null))return false;if(t==null)return true;var n=h(t);var i=n.length;if(h(r).length!==i)return false;var a=true;var o=false;var u=undefined;try{for(var s=n[Symbol.iterator](),l;!(a=(l=s.next()).done);a=true){var f=l.value;if(t[f]!==r[f])return false}}catch(e){o=true;u=e}finally{try{if(!a&&s.return!=null){s.return()}}finally{if(o){throw u}}}return true};var i=function e(t,r){var n={};var i={};var a=t.length;var o=0;while(o<a){i[t[o]]=true;o+=1}var u=true;var s=false;var l=undefined;try{for(var f=h(r)[Symbol.iterator](),c;!(u=(c=f.next()).done);u=true){var v=c.value;if(!(v in i))n[v]=r[v]}}catch(e){s=true;l=e}finally{try{if(!u&&f.return!=null){f.return()}}finally{if(s){throw l}}}return n};var a=function e(t){var r=[];var n=t.length;var i=0;while(i<n){if(Array.isArray(t[i])){var a=e(t[i]);var o=a.length;var u=0;while(u<o){r[r.length]=a[u];u+=1}}else r[r.length]=t[i];i+=1}return r};function o(e,t,r){if(t in e){Object.defineProperty(e,t,{value:r,enumerable:true,configurable:true,writable:true})}else{e[t]=r}return e}function u(e){return s(e)||l(e)||f()}function s(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}function l(e){if(Symbol.iterator in Object(e)||Object.prototype.toString.call(e)==="[object Arguments]")return Array.from(e)}function f(){throw new TypeError("Invalid attempt to spread non-iterable instance")}var c="-";var v=function e(t,r){if(r!=null)return"".concat(t).concat(c).concat(r);else return t};var d=function e(t){if(Array.isArray(t))return t.reduce(function(e,t){return o({},t,true)},{});else if(typeof t==="string")return e(t.split(" "));else return t};var y=function e(t,r){return[t].concat(u(Object.keys(r).filter(function(e){return!!r[e]}).map(function(e){return"".concat(t).concat(c.repeat(2)).concat(e)}))).filter(function(e){return!!e}).join(" ")};var m=function e(t){for(var r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++){n[i-1]=arguments[i]}if(n.length===1){var a=n[0];if(typeof a==="string")return v(t,a);else return y(t,d(a))}else if(n.length===2){var o=n[0],u=n[1];return y(v(t,o),d(u))}else throw new Error("Unrecognized arguments")};var p=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++){t[r]=arguments[r]}if(t.length===1){var n=t[0];return function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++){t[r]=arguments[r]}return m.apply(void 0,[n].concat(t))}}else return m.apply(void 0,t)};t.classNames=p;t.cn=p;t.compose=r;t.keys=h;t.shallowEqual=n;t.omit=i;t.flatten=a});t(K);var n=K.classNames;var i=K.cn;var a=K.compose;var o=K.keys;var u=K.shallowEqual;var s=K.omit;var l=K.flatten;var W=r(function(e,t){Object.defineProperty(t,"__esModule",{value:true});function y(e){if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){y=function(e){return typeof e}}else{y=function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e}}return y(e)}function s(e,t,r,n,i,a,o){try{var u=e[a](o);var s=u.value}catch(e){r(e);return}if(u.done){t(s)}else{Promise.resolve(s).then(n,i)}}function f(u){return function(){var e=this,o=arguments;return new Promise(function(t,r){var n=u.apply(e,o);function i(e){s(n,t,r,i,a,"next",e)}function a(e){s(n,t,r,i,a,"throw",e)}i(undefined)})}}function l(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||false;n.configurable=true;if("value"in n)n.writable=true;Object.defineProperty(e,n.key,n)}}function r(e,t,r){if(t)n(e.prototype,t);if(r)n(e,r);return e}function i(e,t,r){if(t in e){Object.defineProperty(e,t,{value:r,enumerable:true,configurable:true,writable:true})}else{e[t]=r}return e}function c(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};var n=Object.keys(r);if(typeof Object.getOwnPropertySymbols==="function"){n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))}n.forEach(function(e){i(t,e,r[e])})}return t}function k(e,t){return o(e)||v(e,t)||d()}function A(e){return a(e)||u(e)||h()}function a(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}function o(e){if(Array.isArray(e))return e}function u(e){if(Symbol.iterator in Object(e)||Object.prototype.toString.call(e)==="[object Arguments]")return Array.from(e)}function v(e,t){var r=[];var n=true;var i=false;var a=undefined;try{for(var o=e[Symbol.iterator](),u;!(n=(u=o.next()).done);n=true){r.push(u.value);if(t&&r.length===t)break}}catch(e){i=true;a=e}finally{try{if(!n&&o["return"]!=null)o["return"]()}finally{if(i)throw a}}return r}function h(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function d(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}var m=function e(t,r,n,i){l(this,e);this.template=t;this.state=r;this.actions=n;this.hooks=i};var p=function e(t){var r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var i=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;return new m(t instanceof Function?t:function(){return t},r,n,i)};var w=function(){function n(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var r=arguments.length>2&&arguments[2]!==undefined?arguments[2]:[];l(this,n);if(e==null)throw new Error("JSX tag empty ");this.tag=e;this.attrs=t;this.children=r}r(n,[{key:"toString",value:function e(){var t=typeof this.tag==="string"?this.tag:"View";return"".concat(t," ").concat(JSON.stringify(this.attrs||{})).concat(this.children.length>0?"\n".concat(this.children.map(function(e){if(e==null)return"\t''";var t=e.toString();return t.split("\n").map(function(e){return"\t".concat(e)}).join("\n")}).join("\n")):"")}}]);return n}();var N=function e(t){return t instanceof w&&t.tag instanceof m};var S=function e(t){return t instanceof w&&!N(t)};var g=function e(t){return typeof t==="string"};var b=function e(t,r){for(var n=arguments.length,i=new Array(n>2?n-2:0),a=2;a<n;a++){i[a-2]=arguments[a]}var o=i.length===1&&Array.isArray(i[0])?i[0]:i;return new w(t,r,o)};var E=function e(t){return"on".concat(t[0].toUpperCase()).concat(t.substr(1))};var x=function e(t){var r=t.toLowerCase();return r.startsWith("on")?r.substr(2):r};var P=function e(t){var r=t.isSvg,n=r===void 0?false:r;l(this,e);this.isSvg=n};var T=function e(t){return Array.isArray(t)&&t.length===2&&t[0]instanceof Function};var V=function e(t,r){return T(t)&&T(r)&&t[0]===r[0]&&t[1]===r[1]};var O=false;var j=[];var L=new P({});var F=new P({isSvg:true});var C=function e(t){return t.length===0};var I=function e(t,r){return t.tag===r.tag};var z=function e(r){return r.every(function(e,t){return t===0||!N(e)||!N(r[t-1])||e.attrs.key||!I(e,r[t-1])})};var D=function(){function s(e,t){l(this,s);var r=e.tag,n=e.attrs,i=e.children;var a=r.state instanceof Function?r.state(n):r.state;var o=r.actions instanceof Function?r.actions(n):r.actions;var u=r.hooks instanceof Function?r.hooks(n):r.hooks;this.template=r.template;this.state=c({},a||{},n||{});this.actions=this.bindActions(o||{});this.children=i;this.hooks=u||{};this.renderingContext=t||L;this.templateLock=false;this.updateLock=false;this.element=null;this.node=null;this.innerViews=new Map;this.parametrizedEventListeners=new Map;this.scheduledActions=[];this.mounted=false;this.destroyed=false;this.trackedActionUpdate=false;this.container=this.callHook("create")}r(s,[{key:"mount",value:function e(t,r){var n=this;var i=t.ownerDocument;if(this.destroyed)return;var a=false;if(!O){O=true;a=true}var o=this.renderTemplate();if(Array.isArray(o))throw new Error("View can only have one root element");if(S(o)){if(o.tag==="svg")this.renderingContext=F;var u=this.mountNodeElement(t,r,o,[]);this.element=u}else if(N(o)){var s=this.instantiateInnerView(o,[]);s.mount(t,r);this.element=s.element}else{var l=i.createTextNode("".concat(o!=null?o:""));this.element=l;var f=t.childNodes[r]||null;t.insertBefore(l,f)}this.node=o;this.mounted=true;var c=true;var v=false;var h=undefined;try{for(var d=this.scheduledActions[Symbol.iterator](),y;!(c=(y=d.next()).done);c=true){var m=k(y.value,2),p=m[0],w=m[1];this.callAction.apply(this,[p].concat(A(w)))}}catch(e){v=true;h=e}finally{try{if(!c&&d.return!=null){d.return()}}finally{if(v){throw h}}}this.scheduledActions=[];if(a){for(var g=0;g<j.length;g++){var b=j[g];b()}this.callHook("mount");O=false}else j.push(function(){return n.callHook("mount")})}},{key:"update",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;var r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;if(this.destroyed)throw new Error("View has been destroyed");var n=this.updateState(t);var i=this.updateChildrenState(r);var e=this.state!==n||this.children!==i;this.state=n;this.children=i;if(this.mounted&&e){this.refresh();this.callHook("update")}return e}},{key:"refresh",value:function e(){var t=this.renderTemplate();var r=this.node;this.node=t;this.patch(this.element,r,t,[])}},{key:"unmount",value:function e(t){this.mounted=false;if(S(this.node))this.destroyInnerViews(this.node,[]);else if(N(this.node))this.destroyInnerView([]);if(t)this.element.remove();this.callHook("unmount");this.element=null}},{key:"destroy",value:function e(t){this.unmount(t);this.callHook("destroy");this.destroyed=true}},{key:"renderTemplate",value:function e(){this.templateLock=true;var t=this.template(this.state,this.actions,this.children);if(Array.isArray(t))throw new Error("Only one root element must be rendered for a view");t=t!=null?t:"";this.templateLock=false;return t}},{key:"bindActions",value:function e(i){var a=this;var r={};var t=true;var n=false;var o=undefined;try{var u=function e(){var n=l.value;var t=i[n];if(t instanceof Function)r[n]=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++){t[r]=arguments[r]}return a.callAction.apply(a,[i[n]].concat(t))};else r[n]=a.bindActions(t)};for(var s=K.keys(i)[Symbol.iterator](),l;!(t=(l=s.next()).done);t=true){u()}}catch(e){n=true;o=e}finally{try{if(!t&&s.return!=null){s.return()}}finally{if(n){throw o}}}return r}},{key:"callAction",value:function e(t){var n=this;if(this.templateLock)throw new Error("Actions can't be called while rendering view template");for(var r=arguments.length,i=new Array(r>1?r-1:0),a=1;a<r;a++){i[a-1]=arguments[a]}if(this.mounted){var o=!this.updateLock;this.updateLock=true;var u=t.apply(void 0,i)(this.state,this.actions);if(u instanceof Promise){this.updateLock=false;if(this.trackedActionUpdate)this.refresh();this.trackedActionUpdate=false;return f(regeneratorRuntime.mark(function e(){var r;return regeneratorRuntime.wrap(function e(t){while(1){switch(t.prev=t.next){case 0:t.next=2;return u;case 2:r=t.sent;if(!n.destroyed)n.update(r);return t.abrupt("return",n.state);case 5:case"end":return t.stop()}}},e,this)}))()}else{if(o){if(!this.destroyed&&this.mounted){var s=this.update(u);if(!s&&this.trackedActionUpdate)this.refresh();this.trackedActionUpdate=false}else if(!this.destroyed)this.state=this.updateState(u)}else{var l=this.updateState(u);this.trackedActionUpdate=this.trackedActionUpdate||this.state!==l;this.state=l}this.updateLock=false;return this.state}}else this.scheduledActions.push([t,i])}},{key:"updateState",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;if(t==null||t===this.state)return this.state;var r=t!==null?c({},this.state,t):this.state;return!K.shallowEqual(this.state,r)?r:this.state}},{key:"updateChildrenState",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;if(t===null||t===null)return this.children;var r=this.children==null||this.children.length===0;var n=t.length===0;if(r!==n)return t;else return!K.shallowEqual(this.children,t)?t:this.children}},{key:"callHook",value:function e(t){if(t in this.hooks)this.hooks[t](this.element,this.state,this.actions)}},{key:"patch",value:function e(t,r,n,i){if(r===n)return;if(S(r)){if(n==null)this.patchFromNodeToNone(t,r,i);else if(S(n))this.patchFromNodeToNode(t,r,n,i);else if(N(n))this.patchFromNodeToView(t,r,n,i);else this.patchFromNodeToText(t,r,n,i)}else if(N(r)){if(n==null)this.patchFromViewToNone(t,r,i);else if(S(n))this.patchFromViewToNode(t,r,n,i);else if(N(n))this.patchFromViewToView(t,r,n,i);else this.patchFromViewToText(t,r,n,i)}else{if(n==null)this.patchFromTextToNone(t,i);else if(S(n))this.patchFromTextToNode(t,n,i);else if(N(n))this.patchFromTextToView(t,n,i);else this.patchTextNodes(t,r,n,i)}}},{key:"patchFromTextToNone",value:function e(t,r){if(C(r))throw new Error("Root element deleted during patch");t.parentNode.removeChild(t)}},{key:"patchTextNodes",value:function e(t,r,n,i){if(r!==n){var a=t.ownerDocument.createTextNode("".concat(n));t.replaceWith(a);if(C(i))this.element=a}}},{key:"patchFromTextToNode",value:function e(t,r,n){var i=this.createNodeElement(t.ownerDocument,r,n);t.replaceWith(i);if(C(n))this.element=i}},{key:"patchFromTextToView",value:function e(t,r,n){var i=this.instantiateInnerView(r,n);var a=Array.from(t.parentNode.childNodes).findIndex(function(e){return e===t});var o=t.parentNode;t.remove();i.mount(o,a);if(C(n))this.element=i.element}},{key:"patchFromNodeToNone",value:function e(t,r,n){if(C(n))throw new Error("Root element deleted during patch");this.removeParametrizedListeners(r,n);this.destroyInnerViews(r,n);t.remove()}},{key:"patchFromNodeToText",value:function e(t,r,n,i){this.removeParametrizedListeners(r,i);this.destroyInnerViews(r,i);var a=t.ownerDocument.createTextNode("".concat(n));t.replaceWith(a);if(C(i))this.element=a}},{key:"patchFromNodeToNode",value:function e(t,r,n,i){if(r===n)return;if(r.tag===n.tag){this.updateAttributes(t,r,n,i);this.updateChildren(t,r,n,i)}else{this.removeParametrizedListeners(r,i);this.destroyInnerViews(r,i);var a=this.createNodeElement(t.ownerDocument,n,i);t.replaceWith(a);if(C(i))this.element=a}}},{key:"patchFromNodeToView",value:function e(t,r,n,i){this.removeParametrizedListeners(r,i);this.destroyInnerViews(r,i);var a=this.instantiateInnerView(n,i);var o=Array.from(t.parentNode.childNodes).findIndex(function(e){return e===t});var u=t.parentNode;t.remove();a.mount(u,o);if(C(i))this.element=a.element}},{key:"patchFromViewToNone",value:function e(t,r,n){if(C(n))throw new Error("Root element deleted during patch");this.destroyInnerView(n);t.remove()}},{key:"patchFromViewToText",value:function e(t,r,n,i){this.destroyInnerView(i);var a=t.ownerDocument.createTextNode("".concat(n));t.replaceWith(a);if(C(i))this.element=a}},{key:"patchFromViewToNode",value:function e(t,r,n,i){this.destroyInnerView(i);var a=this.createNodeElement(t.ownerDocument,n,i);t.replaceWith(a);if(C(i))this.element=a}},{key:"patchFromViewToView",value:function e(t,r,n,i){if(r===n)return;if(I(r,n)&&r.attrs.key===n.attrs.key){var a=this.getInstantiatedView(i);a.update(n.attrs,n.children)}else{this.destroyInnerView(i);var o=this.instantiateInnerView(n,i);var u=Array.from(t.parentNode.childNodes).findIndex(function(e){return e===t});var s=t.parentNode;t.remove();o.mount(s,u);if(C(i))this.element=o.element}}},{key:"unmountPatch",value:function e(){this.mounted=false;this.callHook("unmount");this.element=null}},{key:"destroyInnerViews",value:function e(t,r){for(var n in t.children){var i=r.concat([n]);var a=t.children[n];if(N(a))this.destroyInnerView(i);else if(S(a))this.destroyInnerViews(a,i)}}},{key:"destroyInnerView",value:function e(t){var r=this.getInstantiatedView(t);r.destroy(false);this.removeInstantiatedView(t)}},{key:"createNodeElement",value:function e(t,r,n){var i;if(this.renderingContext.isSvg)i=t.createElementNS("http://www.w3.org/2000/svg",r.tag);else i=t.createElement(r.tag);this.refreshAttributes(i,r,n);this.refreshChildren(i,r,n);return i}},{key:"mountNodeElement",value:function e(t,r,n,i){var a=t.ownerDocument;var o;if(this.renderingContext.isSvg)o=a.createElementNS("http://www.w3.org/2000/svg",n.tag);else o=a.createElement(n.tag);this.refreshAttributes(o,n,i);var u=t.childNodes[r]||null;t.insertBefore(o,u);this.refreshChildren(o,n,i,true);return o}},{key:"refreshAttributes",value:function e(t,r,n){for(var i in r.attrs){var a=r.attrs[i];this.addAttribute(t,i,a,n)}}},{key:"updateAttributes",value:function e(t,r,n,i){if(r===n)return;for(var a in n.attrs){var o=n.attrs[a];if(a in r.attrs){var u=r.attrs[a];this.updateAttribute(t,a,u,o,i)}else this.addAttribute(t,a,o,i)}for(var s in r.attrs){if(!(s in n.attrs))this.removeAttribute(t,s,r.attrs[s],i)}}},{key:"addAttribute",value:function e(t,r,n,i){if(r==="style"){for(var a in n){this.setStyleProp(t,a,n[a]||"")}}else if(n instanceof Function)this.addEventListener(t,x(r),n);else if(T(n)){var o=this.createParametrizedListener(n[0],n[1],i,r);var u=x(r);this.addEventListener(t,u,o)}else if(r==="data"&&n!=null&&y(n)==="object"){for(var s in n){t.dataset[s]=n[s]}}else if(r!=="focus"&&r in t&&!this.renderingContext.isSvg&&n!=null)t[r]=n;else if(typeof n==="boolean"){if(r==="focus"&&t.focus&&t.blur){if(n)t.focus();else t.blur()}else t.setattribute(r,r)}else if(n!=null)t.setAttribute(r,n)}},{key:"updateAttribute",value:function e(t,r,n,i,a){if(n===i)return;if(V(n,i))return;if(r==="style"){for(var o in n){if(!(o in i))this.removeStyleProp(t,o)}for(var u in i){var s=i[u]||"";this.setStyleProp(t,u,s)}}else if(i instanceof Function){this.removeAttribute(t,r,n,a);this.addAttribute(t,r,i,a)}else if(T(i)){this.removeAttribute(t,r,n,a);this.addAttribute(t,r,i,a)}else if(r==="data"){var l=n!=null&&y(n)==="object";var f=i!=null&&y(i)==="object";if(l&&f){for(var c in n){if(!(c in i))delete t.dataset[c]}for(var v in i){t.dataset[v]=i[v]}}else if(l&&!f){for(var h in t.dataset){delete t.dataset[h]}}else if(!l&&f){for(var d in i){t.dataset[d]=i[d]}}}else if(r!=="focus"&&r in t&&!this.renderingContext.isSvg)t[r]=i;else if(typeof n==="boolean"){if(r==="focus"){if(t.focus&&t.blur){if(i)t.focus();else t.blur()}}else{if(i)t.setAttribute(r,r);else t.removeAttribute(r)}}else{if(i!=null)t.setAttribute(r,i);else t.removeAttribute(i)}}},{key:"removeAttribute",value:function e(t,r,n,i){if(r==="style")t.style.cssText="";else if(n instanceof Function){var a=x(r);this.removeEventListener(t,a,n)}else if(T(n)){var o=this.getParametrizedListener(i,r);var u=x(r);this.removeEventListener(t,u,o)}else if(r==="data"&&n!=null&&y(n)==="object"){for(var s in t.dataset){delete t.dataset[s]}}else if(r!=="focus"&&r in t&&!this.renderingContext.isSvg)t[r]=undefined;else if(typeof n==="boolean"){if(r==="focus"&&t.blur)t.blur();else t.removeAttribute(r)}else if(n!=null)t.removeAttribute(r)}},{key:"setStyleProp",value:function e(t,r,n){if(r[0]==="-"){var i=n.indexOf("!important");var a=n;if(i!==-1)a=i!==n.slice(0,i)+n.slice(i+10);a=a.trim().replace(/;$/,"");t.style.setProperty(r,a)}else t.style[r]=n}},{key:"removeStyleProp",value:function e(t,r){if(r[0]==="-")t.style.removeProperty(r);else delete t.style[r]}},{key:"addEventListener",value:function e(i,a,t){if(i.addEventListener)i.addEventListener(a,t);else if(i.attachEvent)i.attachEvent(E(a),t);else{var r=i[a]&&i[a].listeners||[];if(i[a]!=null)i[a].listeners=r.concat(t);else{var n=function e(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++){r[n]=arguments[n]}return i[a].listeners.map(function(e){return e.apply(void 0,r)})};n.listeners=r.concat(t);i[a]=n}}}},{key:"removeEventListener",value:function e(t,r,n){if(t.removeEventListener)t.removeEventListener(r,n);else if(t.detachEvent)t.detachEvent(E(r),n);else{if(t[r]!=null&&t[r].listeners!=null)t[r].listeners=t[r].listener.filter(function(e){return e!==n})}}},{key:"refreshChildren",value:function e(t,r,n){var i=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;if(!z(r.children))throw new Error("Every view node in an array must have an unique 'key' attribute");for(var a in r.children){var o=r.children[a];var u=n.concat([a]);this.addChildren(t,o,a,u,i)}}},{key:"addChildren",value:function e(t,r){var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var i=arguments.length>3?arguments[3]:undefined;var a=arguments.length>4&&arguments[4]!==undefined?arguments[4]:false;if(S(r)){if(a)this.mountNodeElement(t,null,r,i);else{var o=this.createNodeElement(t.ownerDocument,r,i);t.appendChild(o)}}else if(N(r)){var u=this.instantiateInnerView(r,i);u.mount(t,n)}else if(r!=null){var s=t.ownerDocument.createTextNode("".concat(r));t.appendChild(s)}}},{key:"updateChildren",value:function e(t,r,n,i){if(r===n)return;if(!z(n.children))throw new Error("Every view node in an array must have an unique 'key' attribute");var a=Math.max(r.children.length,n.children.length);var o=0;for(var u=0;u<a;u++){var s=t.childNodes[u-o];var l=r.children[u];var f=u in n.children?n.children[u]:null;var c=i.concat([u]);if(l!=null){this.patch(s,l,f,c);if(f==null)o+=1}else{this.addChildren(t,f,u,c);o-=1}}}},{key:"instantiateInnerView",value:function e(t,r){var n=s.getPathKey(r);var i=s.instantiate(t,this.renderingContext);this.innerViews.set(n,{view:i,path:r.slice()});return i}},{key:"getInstantiatedView",value:function e(t){var r=s.getPathKey(t);var n=this.innerViews.get(r);return n!=null?n.view:null}},{key:"removeInstantiatedView",value:function e(t){var r=s.getPathKey(t);this.innerViews.delete(r)}},{key:"getParametrizedListener",value:function e(t,r){var n=s.getAttrKey(t,r);return this.parametrizedEventListeners.get(n)}},{key:"hasParametrizedListener",value:function e(t,r){var n=s.getAttrKey(t,r);return this.parametrizedEventListeners.has(n)}},{key:"createParametrizedListener",value:function e(i,a,t,r){var n=function e(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++){r[n]=arguments[n]}return i.apply(void 0,A(a).concat(r))};var o=s.getAttrKey(t,r);this.parametrizedEventListeners.set(o,n);return n}},{key:"removeParametrizedListeners",value:function e(t,r){for(var n in t.attrs){if(this.hasParametrizedListener(r,n))this.removeParametrizedListener(r,n)}for(var i in t.children){var a=r.concat([i]);var o=t.children[i];if(S(o))this.removeParametrizedListeners(o,a)}}},{key:"removeParametrizedListener",value:function e(t,r){var n=s.getAttrKey(t,r);this.parametrizedEventListeners.delete(n)}}],[{key:"instantiate",value:function e(t){var r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;if(!N(t))throw new Error("View can only be instantiated from view-nodes");return new s(t,r)}},{key:"getPathKey",value:function e(t){return t.join(".")}},{key:"getAttrKey",value:function e(t,r){return"".concat(r,".").concat(s.getPathKey(t))}}]);return s}();var M=function e(t,r){var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var i=r;if(S(r))i=b(p(r));var a=t.ownerDocument.defaultView;var o=t instanceof a.SVGElement?F:L;var u=D.instantiate(i,o);u.mount(t,n);return u};var H=function e(r){return function(n){var e;if(n instanceof m)e=n;else if(typeof n==="string")e=p(function(e,t,r){return b(n,e,r)});else e=p(n);var t=r(e);if(t instanceof m)return t;else return p(t)}};t.view=p;t.h=b;t.isElementNode=S;t.isViewNode=N;t.isTextNode=g;t.Node=w;t.mount=M;t.decorator=H});t(W);var f=W.view;var c=W.h;var v=W.isElementNode;var h=W.isViewNode;var d=W.isTextNode;var y=W.Node;var m=W.mount;var p=W.decorator;var w=r(function(e,t){Object.defineProperty(t,"__esModule",{value:true});function u(e){if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){u=function(e){return typeof e}}else{u=function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e}}return u(e)}function s(e,t,r,n,i,a,o){try{var u=e[a](o);var s=u.value}catch(e){r(e);return}if(u.done){t(s)}else{Promise.resolve(s).then(n,i)}}function r(u){return function(){var e=this,o=arguments;return new Promise(function(t,r){var n=u.apply(e,o);function i(e){s(n,t,r,i,a,"next",e)}function a(e){s(n,t,r,i,a,"throw",e)}i(undefined)})}}function n(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||false;n.configurable=true;if("value"in n)n.writable=true;Object.defineProperty(e,n.key,n)}}function a(e,t,r){if(t)i(e.prototype,t);if(r)i(e,r);return e}function l(e,t,r){if(t in e){Object.defineProperty(e,t,{value:r,enumerable:true,configurable:true,writable:true})}else{e[t]=r}return e}function f(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};var n=Object.keys(r);if(typeof Object.getOwnPropertySymbols==="function"){n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))}n.forEach(function(e){l(t,e,r[e])})}return t}function o(e,t){if(e==null)return{};var r={};var n=Object.keys(e);var i,a;for(a=0;a<n.length;a++){i=n[a];if(t.indexOf(i)>=0)continue;r[i]=e[i]}return r}function c(e,t){if(e==null)return{};var r=o(e,t);var n,i;if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++){n=a[i];if(t.indexOf(n)>=0)continue;if(!Object.prototype.propertyIsEnumerable.call(e,n))continue;r[n]=e[n]}}return r}var v=function e(n){return W.decorator(function(r){var i=function e(t){if(r.state instanceof Function)return r.state(t);else return r.state};var a=function e(t){if(n instanceof Function)return n(t);else return n};var e=function e(t){var r=i(t);var n=a(t);return f({},r!=null?r:{},n!=null?n:{})};return W.view(r.template,e,r.actions,r.hooks)})};var h=function e(i){return W.decorator(function(r){var n=function e(t){if(r.actions instanceof Function)return r.actions(t);else return r.actions};var e=function e(t){return f({},n(t)||{},i||{})};return W.view(r.template,r.state,e,r.hooks)})};var d=function e(u){return W.decorator(function(r){var o=function e(t){if(r.hooks instanceof Function)return r.hooks(t);else return r.hooks};var e=function e(t){var a=o(t)||{};var r=f({},a);var n=function e(i){r[i]=function(t,r,n){var e=function e(){if(a[i]!=null)a[i](t,r,n)};u[i](e)(t,r,n)}};for(var i in u){n(i)}return r};return W.view(r.template,r.state,r.actions,e)})};var y=function e(t){return W.decorator(function(e){return W.view(t(e.template),e.state,e.actions,e.hooks)})};var m=function e(i){return W.decorator(function(n){return function(e,t,r){return W.h(n,i(e),r)}})};var p=function(){function e(){n(this,e);this.listenerCounter=0;this.listeners={}}a(e,[{key:"subscribe",value:function e(t){var r=this;var n=++this.listenerCounter;this.listeners[n]=t;return function(){return delete r.listeners[n]}}},{key:"notify",value:function e(){for(var t in this.listeners){var r;(r=this.listeners)[t].apply(r,arguments)}}}]);return e}();var w=Symbol("context");var g=function(){function t(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};n(this,t);this.value=e;this.emitter=new p}a(t,[{key:"subscribe",value:function e(t){return this.emitter.subscribe(t)}},{key:"update",value:function e(t){var r=f({},this.value,t);if(R.shallowEqual(this.value,r))return;this.value=r;this.emitter.notify(this.value)}},{key:"get",value:function e(){return this.value}}]);return t}();var b=new Map;var k=1e4;var A=function e(r){return W.decorator(function(e){if(b.has(e.template))return b.get(e.template);else{var t=r(e);if(b.size<k)b.set(e.template,t);return t}})};var N=A(y(function(a){return function(e,t,r){var n=e[w];var i=a(e,t,r);if(n!=null)return S(n)(i);else return i}}));var S=function r(n){return function(e){if(W.isViewNode(e)){var t=f({},e.attrs!=null?e.attrs:{},l({},w,n));return W.h(N(e.tag),t,e.children.map(r(n)))}else if(W.isElementNode(e))return W.h(e.tag,e.attrs,e.children.map(r(n)));else return e}};var E=function e(t){return t};var x=function e(){var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:E;var a=function e(t,r){var n=i(t);if(u(n)!=="object")throw new Error("Context must be an object derived from view's state and actions");return n};return R.compose(d({create:function e(i){return function(e,t,r){i();if(!(w in t)){var n=new g(a(t,r));t[w]=n}}},update:function e(i){return function(e,t,r){i();var n=t[w];n.update(a(t,r))}}}),N)};var P=Symbol("update");var T=Symbol("subscription");var V=function e(t){return{context:t}};var O=function e(){var a=arguments.length>0&&arguments[0]!==undefined?arguments[0]:V;return R.compose(d({create:function e(i){return function(e,t,r){var n=t[w];if(n!=null)Object.assign(t,a(n.value));i();if(n==null)n=t[w];if(n!=null){t[T]=n.subscribe(r[P]);Object.assign(t,a(n.value))}}},destroy:function e(n){return function(e,t,r){if(T in t)t[T]();n()}}}),h(l({},P,function(e){return function(){return f({},a(e))}})))};var j=Symbol("store");var L=function e(r,t){return t.reduce(function(e,t){Object.assign(e,t(r));return e},{})};var F=function e(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++){r[n]=arguments[n]}return R.compose(O(function(e){return j in e?L(e[j].ref,r):{}}),x(function(e){var t=e.store;return t!=null?l({},j,{ref:t}):{}}))};var C={};C.update=function(o){return function(){var t=r(regeneratorRuntime.mark(function e(r){var n,i,a;return regeneratorRuntime.wrap(function e(t){while(1){switch(t.prev=t.next){case 0:n=r.state;i=f({},n);a=o;if(o instanceof Function)a=o(i);if(!(a instanceof Promise)){t.next=8;break}t.next=7;return a;case 7:a=t.sent;case 8:if(a!=null)i=f({},i,a);return t.abrupt("return",{state:i});case 10:case"end":return t.stop()}}},e,this)}));return function(e){return t.apply(this,arguments)}}()};var I=function e(t){return W.decorator(function(e){var o=R.compose(O(function(e){return j in e?{store:e[j].ref}:{}}),x(function(e){var t=e.ref;return l({},j,t)}),m(function(e){var t=e.ref,r=c(e,["ref"]);return f({},r)}))(e);return W.view(function(e,t,r){var n=e.state,i=e.ref,a=c(e,["state","ref"]);i.state=n;i.update=t.update;return W.h(o,f({},a,{ref:{ref:i}}),r)},{state:f({},t),ref:{}},C)})};var z=function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};return I(t)};var D=function a(o){return function(n){var i={};var e=function e(t){var r=o[t];if(r instanceof Function)i[t]=function(){return r(n).apply(void 0,arguments)};else if(u(r)==="object")i[t]=a(r)(n)};for(var t in o){e(t)}return i}};var M=new Map;var H=1e4;var K=function e(r){return W.decorator(function(e){if(M.has(e.template))return M.get(e.template);else{var t=r(e);if(M.size<H)M.set(e.template,t);return t}})};var U=function e(a){return K(y(function(i){return function(e,t,r){var n=i(e,t,r);return _(a)(n)}}))};var _=function a(o){var u=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"styleName";return function(e){if(W.isViewNode(e))return W.h(U(o)(e.tag),e.attrs,e.children.map(a(o)));else if(W.isElementNode(e)){if(e.attrs!=null&&u in e.attrs){var t=(e.attrs[u]||"").split(" ").filter(function(e){return e.length>0});var r=(e.attrs.class||"").split(" ").filter(function(e){return e.length>0});var n=t.map(function(e){return o[e]}).filter(function(e){return e!=null}).concat(r).join(" ");var i=f({},e.attrs);delete i[u];if(n.length>0)i.class=n;return W.h(e.tag,i,e.children.map(a(o)))}else return W.h(e.tag,e.attrs,e.children.map(a(o)))}else return e}};var q=function(t){return W.decorator(function(e){return U(t)(e)})};t.cssModules=q;t.withState=v;t.withActions=h;t.withHooks=d;t.withTemplate=y;t.mapState=m;t.withContext=x;t.getContext=O;t.connect=F;t.withStore=z;t.bindActions=D});var g=t(w);var b=w.cssModules;var k=w.withState;var A=w.withActions;var N=w.withHooks;var S=w.withTemplate;var E=w.mapState;var x=w.withContext;var P=w.getContext;var T=w.connect;var V=w.withStore;var O=w.bindActions;e.default=g;e.cssModules=b;e.withState=k;e.withActions=A;e.withHooks=N;e.withTemplate=S;e.mapState=E;e.withContext=x;e.getContext=P;e.connect=T;e.withStore=V;e.bindActions=O;Object.defineProperty(e,"__esModule",{value:true})});
